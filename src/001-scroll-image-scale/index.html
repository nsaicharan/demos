<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Reveal</title>
  <style>
    body {
      margin: 0;
    }

    .spacer {
      height: 100vh;
      background-color: #ac669a;
    }

    .container {
      background: #101214;
    }

    .row {
      display: flex;

      >* {
        flex: 1;
      }
    }

    img {
      max-width: 100%;
      object-fit: cover;
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <div class="spacer"></div>

  <div class="container">
    <div class="row">
      <div class="col">
        <img src="https://picsum.photos/id/1/500" alt="Placeholder Image">
      </div>

      <div class="col"></div>

      <div class="col">
        <img src="https://picsum.photos/id/2/500" alt="Placeholder Image">
      </div>

      <div class="col"></div>
    </div>

    <div class="row">
      <div class="col"></div>

      <div class="col">
        <img src="https://picsum.photos/id/3/500" alt="Placeholder Image">
      </div>

      <div class="col"></div>

      <div class="col">
        <img src="https://picsum.photos/id/4/500" alt="Placeholder Image">
      </div>
    </div>

    <div class="row">
      <div class="col">
        <img src="https://picsum.photos/id/3/500" alt="Placeholder Image">
      </div>
      <div class="col"></div>
      <div class="col"></div>
      <div class="col"></div>
    </div>

    <div class="row">
      <div class="col"></div>
      <div class="col"></div>
      <div class="col">
        <img src="https://picsum.photos/id/3/500" alt="Placeholder Image">
      </div>
      <div class="col"></div>
    </div>
  </div>

  <div class="spacer"></div>

  <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/lenis@1.3.17/dist/lenis.min.js"></script>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    // Initialize a new Lenis instance for smooth scrolling
    const lenis = new Lenis();

    // Synchronize Lenis scrolling with GSAP's ScrollTrigger plugin
    lenis.on('scroll', ScrollTrigger.update);

    // Add Lenis's requestAnimationFrame (raf) method to GSAP's ticker
    // This ensures Lenis's smooth scroll animation updates on each GSAP tick
    gsap.ticker.add((time) => {
      lenis.raf(time * 1000); // Convert time from seconds to milliseconds
    });

    // Disable lag smoothing in GSAP to prevent any delay in scroll animations
    gsap.ticker.lagSmoothing(0);

    // Main Stuff 
    const rows = document.querySelectorAll('.row');
    rows.forEach((row, index) => {
      const images = row.querySelectorAll('img');

      images.forEach(img => {
        img.style.transformOrigin = index % 2 == 0 ? 'top right' : 'top left'
      })

      gsap.set(images, {
        scale: 0,
      })

      ScrollTrigger.create({
        trigger: row,
        start: 'top 100%',
        end: 'bottom bottom',
        // markers: true,
        onUpdate: (self) => {
          const progress = self.progress;
          console.log('start prgress:', progress)
          gsap.set(images, {
            scale: progress,
          })
        }
      })

      ScrollTrigger.create({
        trigger: row,
        start: 'top top',
        end: 'bottom top',
        pin: true,
        pinSpacing: false,
        onUpdate: (self) => {
          const progress = self.progress;
          console.log('end progress:', progress)
          gsap.set(images, {
            scale: 1 - progress,
          })
        }
      })
    })
  </script>
</body>

</html>